# 宠物医院管理系统 - 后端API接口文档

**生成时间**: 2026-01-08 23:57:13  
**系统版本**: v1.0.8  
**服务器端口**: 8186

---

## 目录

1. [开放接口（无需登录）](#开放接口无需登录)
2. [用户接口（需登录）](#用户接口需登录)
3. [管理员接口（需管理员权限）](#管理员接口需管理员权限)
4. [医生接口（需医生权限）](#医生接口需医生权限)
5. [通用接口](#通用接口)

---

## 开放接口（无需登录）

### 1. 登录相关接口

#### 1.1 用户登录
- **路径**: `/login`
- **方法**: `POST/GET`
- **参数**:
  - `username` (String): 用户名
  - `password` (String): 密码（MD5加密）
  - `captcha` (String): 验证码
- **返回**: `ResultMap`
  - 成功: `{"result":"success","message":"登录成功",...}`
  - 失败: `{"result":"fail","message":"错误信息"}`
- **说明**: 需要先获取验证码图片

#### 1.2 获取验证码图片
- **路径**: `/captcha`
- **方法**: `GET`
- **返回**: 图片流 (image/jpeg)
- **说明**: 验证码存储在Session中，有效期5分钟

#### 1.3 用户注册
- **路径**: `/doRegist`
- **方法**: `POST`
- **参数**:
  - `username` (String): 用户名（必填）
  - `name` (String): 姓名（必填）
  - `phone` (String): 电话号（必填，11位手机号）
  - `email` (String): 邮箱（必填，需验证格式）
  - `password` (String): 密码（必填，至少6位）
  - `password2` (String): 确认密码（必填）
  - `emailCode` (String): 邮箱验证码（必填）
- **返回**: `ResultMap`
- **说明**: 注册时默认角色为普通用户(role=3)

#### 1.4 发送注册邮箱验证码
- **路径**: `/sendEmailCode`
- **方法**: `POST`
- **参数**:
  - `email` (String): 邮箱地址
- **返回**: `ResultMap`
- **说明**: 验证码发送间隔限制60秒

#### 1.5 发送找回密码验证码
- **路径**: `/sendResetPasswordCode`
- **方法**: `POST`
- **参数**:
  - `email` (String): 邮箱地址
- **返回**: `ResultMap`
- **说明**: 邮箱必须已注册

#### 1.6 重置密码
- **路径**: `/resetPassword`
- **方法**: `POST`
- **参数**:
  - `email` (String): 邮箱地址
  - `emailCode` (String): 邮箱验证码
  - `newPassword` (String): 新密码（至少6位）
  - `newPassword2` (String): 确认新密码
- **返回**: `ResultMap`

#### 1.7 退出登录
- **路径**: `/logout`
- **方法**: `GET`
- **返回**: `ResultMap`

#### 1.8 未登录提示
- **路径**: `/notLogin`
- **方法**: `GET`
- **返回**: `ResultMap` - "您尚未登陆！"

#### 1.9 无权限提示
- **路径**: `/notRole`
- **方法**: `GET`
- **返回**: `ResultMap` - "您没有权限！"

### 2. 文件上传接口

#### 2.1 富文本编辑器图片上传
- **路径**: `/upload`
- **方法**: `POST`
- **参数**:
  - `upload` (MultipartFile): 图片文件
  - `CKEditorFuncNum` (String): CKEditor回调函数序号
- **返回**: JSON字符串（CKEditor格式）
- **说明**: 文件保存路径为 `D://upload//`

#### 2.2 Layui图片上传
- **路径**: `/layuiUpload`
- **方法**: `POST`
- **参数**:
  - `file` (MultipartFile): 图片文件
  - `CKEditorFuncNum` (String): CKEditor回调函数序号
- **返回**: JSON字符串
- **说明**: 文件保存路径为 `D://upload//`

### 3. 错误处理接口

#### 3.1 SPA路由错误处理
- **路径**: `/error`
- **方法**: `GET`
- **说明**: 用于Vue前端路由刷新兼容

---

## 用户接口（需登录）

### 1. 用户信息管理

#### 1.1 获取当前登录用户信息
- **路径**: `/user/getCurrentUser`
- **方法**: `GET`
- **返回**: `ResultMap`
  ```json
  {
    "result": "success",
    "id": 1,
    "username": "用户名",
    "name": "姓名",
    "phone": "电话",
    "email": "邮箱",
    "address": "地址",
    "roleId": 3
  }
  ```
- **说明**: roleId: 1=管理员, 2=医生, 3=普通用户

#### 1.2 更新用户信息
- **路径**: `/user/updateUser`
- **方法**: `POST/GET`
- **参数**: `User` 对象
- **返回**: `String` - "SUCCESS" 或错误信息

#### 1.3 检查旧密码是否正确
- **路径**: `/user/checkUserPassword`
- **方法**: `POST/GET`
- **参数**:
  - `password` (String): 旧密码
- **返回**: `boolean`

#### 1.4 更新密码
- **路径**: `/user/updatePassword`
- **方法**: `POST/GET`
- **参数**:
  - `password` (String): 新密码
- **返回**: `String` - "SUCCESS" 或错误信息

#### 1.5 获取用户权限信息
- **路径**: `/user/getMessage`
- **方法**: `GET`
- **返回**: `ResultMap` - "您拥有用户权限，可以获得该接口的信息！"

### 2. 宠物管理

#### 2.1 获取宠物列表（普通用户）
- **路径**: `/user/pet/getAllByLimit`
- **方法**: `POST/GET`
- **参数**: `Pet` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Pet>`
- **说明**: 自动过滤当前用户的宠物

#### 2.2 获取宠物列表（医生）
- **路径**: `/user/pet/getAllByLimitDoctor`
- **方法**: `POST/GET`
- **参数**: `Pet` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Pet>`
- **说明**: 可查看所有宠物

#### 2.3 添加宠物
- **路径**: `/user/pet/doAdd`
- **方法**: `POST/GET`
- **参数**: `Pet` 对象
- **返回**: `String` - "SUCCESS" 或 "ERROR"
- **说明**: 自动设置userId为当前登录用户

#### 2.4 删除宠物
- **路径**: `/user/pet/del`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 宠物ID
  - `type` (Long): 类型（可选，type=2时返回"app"表示有预约记录）
- **返回**: `String` - "SUCCESS"、"ERROR" 或 "app"
- **说明**: 删除宠物时会同时删除关联的宠物日志记录

### 3. 宠物日志管理

#### 3.1 获取宠物日志列表（普通用户）
- **路径**: `/user/petDaily/getAllByLimit`
- **方法**: `POST/GET`
- **参数**: `PetDaily` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<PetDaily>`
- **说明**: 自动过滤当前用户的宠物日志

#### 3.2 获取宠物日志列表（医生）
- **路径**: `/user/petDaily/getAllByLimitDoctor`
- **方法**: `POST/GET`
- **参数**: `PetDaily` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<PetDaily>`

#### 3.3 添加宠物日志
- **路径**: `/user/petDaily/doAdd`
- **方法**: `POST/GET`
- **参数**: `PetDaily` 对象
- **返回**: `String` - "SUCCESS" 或 "ERROR"
- **说明**: 自动设置userId和createTime

#### 3.4 删除宠物日志
- **路径**: `/user/petDaily/del`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 日志ID
- **返回**: `String` - "SUCCESS" 或 "ERROR"

### 4. 预约管理

#### 4.1 获取预约列表（普通用户）
- **路径**: `/user/apply/getAllByLimit`
- **方法**: `POST/GET`
- **参数**: `Appointment` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Appointment>`
- **说明**: 自动过滤当前用户的预约

#### 4.2 获取预约列表（医生）
- **路径**: `/user/apply/getAllByLimitDoctor`
- **方法**: `POST/GET`
- **参数**: `Appointment` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Appointment>`

#### 4.3 添加预约
- **路径**: `/user/apply/doAdd`
- **方法**: `POST/GET`
- **参数**: `Appointment` 对象
  - `petId` (Long): 宠物ID（必填）
  - `doctorId` (Long): 医生ID（必填）
  - `appointmentTypeId` (Long): 预约类型ID（必填）
  - `timeSlot` (String): 时间段（必填）
  - `appTime` (Date): 预约时间（可选，默认当前时间）
- **返回**: `String`
  - "SUCCESS": 成功
  - "noPetId": 未选择宠物
  - "noDoctorOrTypeOrSlot": 未选择医生、类型或时间段
  - "FULL": 该时间段已约满
  - "ERROR": 其他错误
- **说明**: 
  - 自动设置userId和createTime
  - 默认状态为1（申请中）
  - 会进行容量校验

#### 4.4 删除预约
- **路径**: `/user/apply/del`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 预约ID
- **返回**: `String` - "SUCCESS" 或 "ERROR"

#### 4.5 修改预约状态
- **路径**: `/user/apply/chStatus`
- **方法**: `POST/GET`
- **参数**: `Appointment` 对象
  - `id` (Long): 预约ID
  - `status` (Integer): 状态（1=申请中, 2=申请通过, 3=不通过, 4=已完成）
- **返回**: `String`
  - "SUCCESS": 成功
  - "jz": 状态为4（已完成）时返回
  - "ERROR": 错误
- **说明**: 医生操作，自动设置doctorId

#### 4.6 获取医生可用时间段
- **路径**: `/user/apply/getAvailableSlots`
- **方法**: `POST/GET`
- **参数**:
  - `doctorId` (Long): 医生ID
  - `appDate` (String): 预约日期（格式：yyyy-MM-dd）
- **返回**: `Object` - 可用时间段列表 或 "noDoctorOrDate" 或 "ERROR"

### 5. 预约类型管理

#### 5.1 获取启用的预约类型列表（用户端）
- **路径**: `/appointmentType/list`
- **方法**: `POST/GET`
- **返回**: `List<AppointmentType>`
- **说明**: 只返回启用状态的类型

#### 5.2 获取所有预约类型列表（管理员）
- **路径**: `/appointmentType/listAll`
- **方法**: `POST/GET`
- **返回**: `List<AppointmentType>` 或 "NO_PERMISSION" 或 "ERROR"
- **权限**: 仅管理员

#### 5.3 添加预约类型（管理员）
- **路径**: `/appointmentType/add`
- **方法**: `POST/GET`
- **参数**: `AppointmentType` 对象
  - `name` (String): 类型名称（必填）
  - `description` (String): 描述
  - `status` (Integer): 状态（1=启用，默认1）
- **返回**: `String`
  - "SUCCESS": 成功
  - "NO_PERMISSION": 无权限
  - "noName": 名称为空
  - "ERROR": 错误
- **权限**: 仅管理员

#### 5.4 更新预约类型（管理员）
- **路径**: `/appointmentType/update`
- **方法**: `POST/GET`
- **参数**: `AppointmentType` 对象
- **返回**: `String` - "SUCCESS"、"NO_PERMISSION" 或 "ERROR"
- **权限**: 仅管理员

#### 5.5 删除预约类型（管理员）
- **路径**: `/appointmentType/delete`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 类型ID
- **返回**: `String` - "SUCCESS"、"NO_PERMISSION"、"noId" 或 "ERROR"
- **权限**: 仅管理员

### 6. 诊断记录管理

#### 6.1 获取诊断记录列表（普通用户）
- **路径**: `/user/diagnosis/getAllByLimit`
- **方法**: `POST/GET`
- **参数**: `Diagnosis` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Diagnosis>`
- **说明**: 自动过滤当前用户的诊断记录

#### 6.2 获取诊断记录列表（医生）
- **路径**: `/user/diagnosis/getAllByLimitDoctor`
- **方法**: `POST/GET`
- **参数**: `Diagnosis` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Diagnosis>`

#### 6.3 添加诊断记录
- **路径**: `/user/diagnosis/doAdd`
- **方法**: `POST/GET`
- **参数**: `Diagnosis` 对象
- **返回**: `String` - "SUCCESS" 或 "ERROR"
- **说明**: 医生操作，自动设置doctorId、createTime和status=1

#### 6.4 修改诊断状态
- **路径**: `/user/diagnosis/chStatus`
- **方法**: `POST/GET`
- **参数**: `Diagnosis` 对象
- **返回**: `String` - "SUCCESS" 或 "ERROR"
- **说明**: 医生操作，自动设置doctorId

#### 6.5 删除诊断记录
- **路径**: `/user/diagnosis/del`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 诊断记录ID
- **返回**: `String` - "SUCCESS" 或 "ERROR"

### 7. 健康标准管理

#### 7.1 获取健康标准列表（普通用户）
- **路径**: `/user/standard/getAllByLimit`
- **方法**: `POST/GET`
- **参数**: `Standard` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Standard>`

#### 7.2 获取健康标准列表（医生）
- **路径**: `/user/standard/getAllByLimitDoctor`
- **方法**: `POST/GET`
- **参数**: `Standard` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Standard>`

#### 7.3 添加健康标准
- **路径**: `/user/standard/doAdd`
- **方法**: `POST/GET`
- **参数**: `Standard` 对象
- **返回**: `String` - "SUCCESS" 或 "ERROR"

#### 7.4 删除健康标准
- **路径**: `/user/standard/del`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 标准ID
- **返回**: `String` - "SUCCESS" 或 "ERROR"

### 8. 健康指南管理

#### 8.1 获取健康指南列表
- **路径**: `/user/notice/getAllWordByLimit`
- **方法**: `POST/GET`
- **参数**: `Notice` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Notice>`

#### 8.2 获取健康指南详情
- **路径**: `/user/notice/getById`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 指南ID
- **返回**: `Object` - 指南详情对象 或 "ERROR"
  ```json
  {
    "id": 1,
    "title": "标题",
    "viewCount": 100,
    "createTime": "2026-01-08",
    "content": "内容"
  }
  ```
- **说明**: 获取详情时会自动增加浏览量

#### 8.3 添加健康指南
- **路径**: `/user/notice/addWord`
- **方法**: `POST/GET`
- **参数**: `Notice` 对象
- **返回**: `String` - "SUCCESS" 或 "ERR"
- **说明**: 自动设置createTime和viewCount=0

#### 8.4 删除健康指南
- **路径**: `/user/notice/delWord`
- **方法**: `POST/GET`
- **参数**:
  - `ids` (String[]): 指南ID数组
- **返回**: `String` - "SUCCESS" 或 "ERR"
- **说明**: 支持批量删除

### 9. 药品管理

#### 9.1 获取药品列表
- **路径**: `/user/medicine/getAllByLimit`
- **方法**: `POST/GET`
- **参数**: `Medicine` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<Medicine>`

#### 9.2 根据ID获取药品详情
- **路径**: `/user/medicine/getById`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 药品ID
- **返回**: `Medicine` 对象

#### 9.3 添加药品
- **路径**: `/user/medicine/doAdd`
- **方法**: `POST/GET`
- **参数**: `Medicine` 对象
- **返回**: `String`
  - "SUCCESS": 成功
  - "LGINOUT": 未登录
  - "ERROR:无权限": 无权限（仅医生和管理员可添加）
  - "ERROR": 其他错误
- **权限**: 医生或管理员

#### 9.4 更新药品信息
- **路径**: `/user/medicine/update`
- **方法**: `POST/GET`
- **参数**: `Medicine` 对象
- **返回**: `String`
  - "SUCCESS": 成功
  - "LGINOUT": 未登录
  - "ERROR:无权限": 无权限
  - "ERROR": 其他错误
- **权限**: 医生或管理员

#### 9.5 删除药品
- **路径**: `/user/medicine/del`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 药品ID
- **返回**: `String`
  - "SUCCESS": 成功
  - "LGINOUT": 未登录
  - "ERROR:无权限": 无权限
  - "ERROR": 其他错误
- **权限**: 医生或管理员

### 10. 开药记录管理

#### 10.1 获取开药记录列表（普通用户）
- **路径**: `/user/medicineRecord/getAllByLimit`
- **方法**: `POST/GET`
- **参数**: `MedicineRecord` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<MedicineRecord>`
- **说明**: 自动过滤当前用户的记录

#### 10.2 获取开药记录列表（医生）
- **路径**: `/user/medicineRecord/getAllByLimitDoctor`
- **方法**: `POST/GET`
- **参数**: `MedicineRecord` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<MedicineRecord>`

#### 10.3 根据诊断ID查询开药记录
- **路径**: `/user/medicineRecord/getByDiagnosisId`
- **方法**: `POST/GET`
- **参数**:
  - `diagnosisId` (Long): 诊断记录ID
- **返回**: `List<MedicineRecord>`

#### 10.4 开具药品
- **路径**: `/user/medicineRecord/doAdd`
- **方法**: `POST/GET`
- **参数**: `MedicineRecord` 对象
  - `medicineId` (Long): 药品ID
  - `quantity` (Integer): 数量
  - `diagnosisId` (Long): 诊断记录ID
- **返回**: `String`
  - "SUCCESS": 成功
  - "LGINOUT": 未登录
  - "ERROR:只有医生可以开具药品": 无权限
  - "ERROR:药品不存在": 药品不存在
  - "ERROR:药品已下架": 药品已下架
  - "ERROR:药品库存不足": 库存不足
  - "ERROR": 其他错误
- **权限**: 仅医生
- **说明**: 
  - 自动设置doctorId和createTime
  - 会自动减少药品库存

#### 10.5 删除开药记录
- **路径**: `/user/medicineRecord/del`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 记录ID
- **返回**: `String`
  - "SUCCESS": 成功
  - "LGINOUT": 未登录
  - "ERROR:无权限": 无权限
  - "ERROR": 其他错误
- **权限**: 医生或管理员

### 11. 健康评估相关

#### 11.1 获取宠物日志统计数据（普通用户）
- **路径**: `/health/tjDailyData`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 宠物ID
- **返回**: `List<PetDaily>` - 包含dateTime字段的日志列表

#### 11.2 获取宠物日志统计数据（医生）
- **路径**: `/health/tjDailyDataDoctor`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 宠物ID
- **返回**: `List<PetDaily>` - 包含dateTime字段的日志列表

#### 11.3 获取医生空闲时间
- **路径**: `/health/getFreeTime`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 医生ID
  - `date` (String): 日期（格式：yyyy-MM-dd）
- **返回**: `Object`
  ```json
  {
    "n": "医生姓名",
    "t": ["8点", "9点", ...],
    "v": [0, 1, ...]
  }
  ```
- **说明**: t为时间段列表，v为对应时间段的预约数量

---

## 管理员接口（需管理员权限）

### 1. 角色管理

#### 1.1 获取所有角色
- **路径**: `/admin/getAllRole`
- **方法**: `POST/GET`
- **返回**: `List<Role>`
- **权限**: 管理员

#### 1.2 添加角色
- **路径**: `/admin/addRole`
- **方法**: `POST/GET`
- **参数**:
  - `name` (String): 角色名称
- **返回**: `String` - "SUCCESS" 或错误信息
- **权限**: 管理员

#### 1.3 更新角色
- **路径**: `/admin/updateRole`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Integer): 角色ID
  - `name` (String): 角色名称
- **返回**: `String` - "SUCCESS" 或 "ERROR"
- **权限**: 管理员

#### 1.4 删除角色
- **路径**: `/admin/delRole`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Integer): 角色ID
- **返回**: `String` - "SUCCESS" 或 "ERROR"
- **权限**: 管理员
- **说明**: 删除角色时会同时删除角色权限表和用户角色关联

### 2. 页面权限管理

#### 2.1 获取所有页面
- **路径**: `/admin/getAllPage`
- **方法**: `POST/GET`
- **返回**: `List<Page>`
- **权限**: 管理员

#### 2.2 根据角色ID获取页面权限
- **路径**: `/admin/getPageByRole`
- **方法**: `POST/GET`
- **参数**:
  - `roleId` (Integer): 角色ID
- **返回**: `List<Page>`
- **权限**: 管理员

#### 2.3 添加页面
- **路径**: `/admin/addPage`
- **方法**: `POST/GET`
- **参数**: `Page` 对象
- **返回**: `Page` 对象
- **权限**: 管理员

#### 2.4 更新页面
- **路径**: `/admin/updatePageById`
- **方法**: `POST/GET`
- **参数**: `Page` 对象
- **返回**: `ResultMap`
- **权限**: 管理员

#### 2.5 删除页面
- **路径**: `/admin/delPageById`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Integer): 页面ID
- **返回**: `ResultMap`
- **权限**: 管理员

#### 2.6 设置角色页面权限
- **路径**: `/admin/addPageRoleByRoleId`
- **方法**: `POST/GET`
- **参数**:
  - `roleId` (Integer): 角色ID（必填）
  - `pageIds` (Integer[]): 页面ID数组
- **返回**: `String` - "SUCCESS" 或 "ERROR"
- **权限**: 管理员
- **说明**: 会先删除该角色的旧权限，再添加新权限

### 3. 用户管理

#### 3.1 获取用户列表（分页）
- **路径**: `/admin/getAllUserByLimit`
- **方法**: `POST/GET`
- **参数**: `UserParameter` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<User>`
- **权限**: 管理员

#### 3.2 获取已删除用户列表（分页）
- **路径**: `/admin/getAllDelUserByLimit`
- **方法**: `POST/GET`
- **参数**: `UserParameter` 对象（分页参数：page, limit）
- **返回**: `MMGridPageVoBean<User>`
- **权限**: 管理员

#### 3.3 根据角色ID获取用户列表
- **路径**: `/admin/getAllUserByRoleId`
- **方法**: `POST/GET`
- **参数**:
  - `roleId` (Integer): 角色ID
  - `roleNot` (String): 是否排除该角色（可选）
  - `page` (Integer): 页码
  - `limit` (Integer): 每页数量
- **返回**: `MMGridPageVoBean<User>`
- **权限**: 管理员
- **说明**: 如果roleNot不为空，则返回不包含该角色的用户

#### 3.4 添加用户
- **路径**: `/admin/addUser`
- **方法**: `POST/GET`
- **参数**: `User` 对象
  - `username` (String): 用户名（必填）
  - `name` (String): 姓名（必填）
  - `phone` (String): 电话号（必填）
  - `password` (String): 密码（必填，MD5加密）
- **返回**: `String`
  - "SUCCESS": 成功
  - "ERR:电话不能为空": 电话为空
  - "ERR:用户名不能为空": 用户名为空
  - "ERR:密码不能为空": 密码为空
  - "ERR:用户名已存在，请使用其他用户名": 用户名重复
  - "ERR:添加用户后无法获取用户信息": 添加失败
  - 其他错误信息
- **权限**: 管理员
- **说明**: 添加用户后会自动设置为医生角色(role=2)

#### 3.5 更新用户信息
- **路径**: `/admin/updateUser`
- **方法**: `POST/GET`
- **参数**:
  - `user` (User): 用户对象
  - `oldId` (Long): 原用户ID
- **返回**: `String` - "SUCCESS" 或错误信息
- **权限**: 管理员

#### 3.6 检查用户ID是否存在
- **路径**: `/admin/checkUserId`
- **方法**: `POST/GET`
- **参数**:
  - `userId` (Long): 用户ID
- **返回**: `User` 对象 或 `null`
- **权限**: 管理员

#### 3.7 批量删除用户
- **路径**: `/admin/delUser`
- **方法**: `POST/GET`
- **参数**:
  - `ids` (Long[]): 用户ID数组
- **返回**: `String`
  - "SUCCESS": 成功
  - "DontOP": 不能删除自己
  - "ERROR": 错误
- **权限**: 管理员
- **说明**: 不能删除当前登录的管理员自己

#### 3.8 重置用户密码
- **路径**: `/admin/resetPassword`
- **方法**: `POST/GET`
- **参数**:
  - `userId` (Long): 用户ID
- **返回**: `String`
  - "SUCCESS": 成功
  - "ERR:用户ID不能为空": 参数错误
  - 其他错误信息
- **权限**: 管理员
- **说明**: 将用户密码重置为用户名

### 4. 用户角色分配

#### 4.1 添加用户角色
- **路径**: `/admin/addUserRole`
- **方法**: `POST/GET`
- **参数**:
  - `roleId` (Integer): 角色ID
  - `userIds` (String[]): 用户ID数组
- **返回**: `String` - "SUCCESS" 或错误信息
- **权限**: 管理员

#### 4.2 移除用户角色
- **路径**: `/admin/delUserRoleByUserIdAndRoleId`
- **方法**: `POST/GET`
- **参数**:
  - `userId` (String): 用户ID
  - `roleId` (Integer): 角色ID
- **返回**: `ResultMap`
- **权限**: 管理员
- **说明**: 移除角色后，用户角色会设置为普通用户(role=3)

---

## 医生接口（需医生权限）

### 1. 医生排班管理

#### 1.1 获取排班列表
- **路径**: `/doctor/schedule/list`
- **方法**: `POST/GET`
- **参数**:
  - `doctorId` (Long): 医生ID（可选，管理员可指定，医生只能查看自己的）
- **返回**: `List<DoctorSchedule>` 或 "ERROR"
- **权限**: 医生或管理员
- **说明**: 
  - 医生只能查看自己的排班
  - 管理员可以查看任意医生的排班

#### 1.2 添加排班
- **路径**: `/doctor/schedule/add`
- **方法**: `POST/GET`
- **参数**: `DoctorSchedule` 对象
  - `doctorId` (Long): 医生ID（必填，医生只能给自己添加）
- **返回**: `String`
  - "SUCCESS": 成功
  - "noDoctorId": 医生ID为空
  - "ERROR": 错误
- **权限**: 医生或管理员
- **说明**: 医生只能给自己添加排班

#### 1.3 更新排班
- **路径**: `/doctor/schedule/update`
- **方法**: `POST/GET`
- **参数**: `DoctorSchedule` 对象
- **返回**: `String`
  - "SUCCESS": 成功
  - "NO_PERMISSION": 无权限（医生只能修改自己的排班）
  - "ERROR": 错误
- **权限**: 医生或管理员
- **说明**: 医生只能修改自己的排班

#### 1.4 删除排班
- **路径**: `/doctor/schedule/delete`
- **方法**: `POST/GET`
- **参数**:
  - `id` (Long): 排班ID
- **返回**: `String`
  - "SUCCESS": 成功
  - "NO_PERMISSION": 无权限（医生只能删除自己的排班）
  - "ERROR": 错误
- **权限**: 医生或管理员
- **说明**: 医生只能删除自己的排班

#### 1.5 批量保存排班
- **路径**: `/doctor/schedule/batchSave`
- **方法**: `POST/GET`
- **参数**:
  - `schedules` (List<DoctorSchedule>): 排班列表
- **返回**: `String`
  - "SUCCESS": 成功
  - "EMPTY": 列表为空
  - "ERROR": 错误
- **权限**: 医生或管理员
- **说明**: 用于一次性设置一周的排班，医生只能设置自己的排班

### 2. 医生服务类型管理

#### 2.1 获取医生服务类型列表
- **路径**: `/doctor/serviceType/list`
- **方法**: `POST/GET`
- **参数**:
  - `doctorId` (Long): 医生ID（可选，管理员可指定，医生只能查看自己的）
- **返回**: `List<DoctorServiceType>` 或 "ERROR"
- **权限**: 医生或管理员
- **说明**: 医生只能查看自己的服务类型

#### 2.2 设置医生服务类型
- **路径**: `/doctor/serviceType/set`
- **方法**: `POST/GET`
- **参数**:
  - `doctorId` (Long): 医生ID（可选，管理员可指定，医生只能设置自己的）
  - `typeIds` (Long[]): 预约类型ID数组
- **返回**: `String`
  - "SUCCESS": 成功
  - "NO_LOGIN": 未登录
  - "noDoctorId": 医生ID为空
  - "ERROR": 错误
- **权限**: 医生或管理员
- **说明**: 
  - 医生只能设置自己的服务类型
  - 管理员可以设置任意医生的服务类型
  - typeIds为空数组表示清空所有服务类型

---

## 通用接口

### 1. 数据模型说明

#### 1.1 分页返回格式
所有分页查询接口返回格式为 `MMGridPageVoBean<T>`:
```json
{
  "total": 100,
  "rows": [...]
}
```
- `total`: 总记录数
- `rows`: 当前页数据列表

#### 1.2 ResultMap 返回格式
```json
{
  "result": "success|fail",
  "message": "消息内容",
  ...其他数据
}
```

### 2. 状态码说明

#### 2.1 预约状态
- `1`: 申请中
- `2`: 申请通过
- `3`: 不通过
- `4`: 已完成

#### 2.2 诊断状态
- `1`: 健康
- `2`: 异常
- `3`: 比较严重
- `4`: 无法治疗

#### 2.3 用户角色
- `1`: 管理员
- `2`: 医生
- `3`: 普通用户

#### 2.4 药品状态
- `1`: 上架
- `0`: 下架

#### 2.5 预约类型状态
- `1`: 启用
- `0`: 禁用

### 3. 错误码说明

| 错误码 | 说明 |
|--------|------|
| SUCCESS | 操作成功 |
| ERROR | 操作失败 |
| NO_PERMISSION | 无权限 |
| NO_LOGIN | 未登录 |
| LGINOUT | 未登录 |
| noId | ID为空 |
| noName | 名称为空 |
| noPetId | 宠物ID为空 |
| noDoctorId | 医生ID为空 |
| noDoctorOrTypeOrSlot | 缺少医生、类型或时间段 |
| noDoctorOrDate | 缺少医生或日期 |
| FULL | 时间段已约满 |
| DontOP | 不能操作自己 |
| EMPTY | 列表为空 |
| app | 存在关联预约记录 |

### 4. 接口调用说明

#### 4.1 认证方式
- 使用 Apache Shiro 进行身份认证
- 登录后会在 Session 中保存用户信息
- 需要登录的接口会自动从 Session 获取当前用户

#### 4.2 权限控制
- 管理员(role=1): 拥有所有权限
- 医生(role=2): 可以管理自己的排班、服务类型，可以开具药品、添加诊断记录等
- 普通用户(role=3): 只能管理自己的宠物、预约等

#### 4.3 分页参数
- `page`: 页码（从1开始）
- `limit`: 每页数量

#### 4.4 日期格式
- 日期字符串格式: `yyyy-MM-dd`
- 日期时间格式: `yyyy/MM/dd HH:mm:ss` (由Jackson配置)

### 5. 注意事项

1. **密码加密**: 所有密码在传输和存储时都使用MD5加密
2. **验证码**: 登录需要验证码，验证码存储在Session中，有效期5分钟，使用后自动清除
3. **邮箱验证**: 注册和找回密码需要邮箱验证码，验证码发送间隔限制60秒
4. **事务管理**: 所有写操作都使用 `@Transactional` 注解，失败会自动回滚
5. **文件上传**: 文件上传路径为 `D://upload//`，需要确保该目录存在且有写权限
6. **SPA路由**: 前端使用Vue单页应用，后端 `/error` 接口用于处理路由刷新兼容

---

## 附录

### A. 接口统计

- **开放接口**: 11个
- **用户接口**: 60个
- **管理员接口**: 20个
- **医生接口**: 7个
- **总计**: 98个接口

### B. 技术栈

- **后端框架**: Spring Boot
- **安全框架**: Apache Shiro
- **ORM框架**: MyBatis
- **数据库**: MySQL
- **分页插件**: PageHelper
- **邮件服务**: Spring Mail (SMTP)

### C. 数据库配置

- **端口**: 3306
- **数据库名**: phms
- **字符编码**: UTF-8
- **时区**: UTC

### D. 服务器配置

- **服务端口**: 8186
- **静态资源路径**: `/static/`
- **文件上传大小限制**: 10MB

---

**文档结束**