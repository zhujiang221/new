/**
 * 简单的拼音首字母提取工具
 * 将中文转换为拼音首字母，用于排序
 */

// 拼音首字母映射表（常用汉字）
const pinyinMap: Record<string, string> = {
  '阿': 'A', '啊': 'A', '艾': 'A', '安': 'A', '昂': 'A',
  '八': 'B', '巴': 'B', '白': 'B', '百': 'B', '班': 'B', '帮': 'B', '包': 'B', '保': 'B', '报': 'B', '北': 'B', '被': 'B', '本': 'B', '比': 'B', '必': 'B', '边': 'B', '变': 'B', '表': 'B', '别': 'B', '宾': 'B', '冰': 'B', '并': 'B', '波': 'B', '博': 'B', '不': 'B', '布': 'B',
  '才': 'C', '材': 'C', '财': 'C', '采': 'C', '菜': 'C', '参': 'C', '残': 'C', '仓': 'C', '操': 'C', '草': 'C', '策': 'C', '层': 'C', '查': 'C', '差': 'C', '产': 'C', '长': 'C', '常': 'C', '场': 'C', '厂': 'C', '超': 'C', '朝': 'C', '车': 'C', '陈': 'C', '成': 'C', '城': 'C', '程': 'C', '吃': 'C', '持': 'C', '充': 'C', '冲': 'C', '出': 'C', '初': 'C', '除': 'C', '处': 'C', '传': 'C', '创': 'C', '春': 'C', '此': 'C', '从': 'C', '促': 'C',
  '大': 'D', '代': 'D', '带': 'D', '待': 'D', '单': 'D', '但': 'D', '当': 'D', '党': 'D', '到': 'D', '道': 'D', '得': 'D', '的': 'D', '等': 'D', '低': 'D', '地': 'D', '第': 'D', '点': 'D', '电': 'D', '调': 'D', '定': 'D', '东': 'D', '动': 'D', '都': 'D', '读': 'D', '度': 'D', '段': 'D', '对': 'D', '多': 'D',
  '而': 'E', '二': 'E', '儿': 'E', '耳': 'E',
  '发': 'F', '法': 'F', '反': 'F', '方': 'F', '防': 'F', '房': 'F', '放': 'F', '非': 'F', '费': 'F', '分': 'F', '份': 'F', '风': 'F', '封': 'F', '服': 'F', '府': 'F', '复': 'F', '副': 'F', '富': 'F',
  '该': 'G', '改': 'G', '概': 'G', '干': 'G', '感': 'G', '刚': 'G', '高': 'G', '告': 'G', '个': 'G', '各': 'G', '给': 'G', '根': 'G', '跟': 'G', '更': 'G', '工': 'G', '公': 'G', '功': 'G', '共': 'G', '构': 'G', '够': 'G', '古': 'G', '故': 'G', '顾': 'G', '关': 'G', '观': 'G', '管': 'G', '光': 'G', '广': 'G', '规': 'G', '国': 'G', '过': 'G',
  '还': 'H', '海': 'H', '含': 'H', '汉': 'H', '好': 'H', '号': 'H', '和': 'H', '合': 'H', '河': 'H', '黑': 'H', '很': 'H', '红': 'H', '后': 'H', '候': 'H', '呼': 'H', '护': 'H', '花': 'H', '化': 'H', '话': 'H', '画': 'H', '划': 'H', '华': 'H', '怀': 'H', '坏': 'H', '欢': 'H', '环': 'H', '换': 'H', '黄': 'H', '回': 'H', '会': 'H', '活': 'H', '火': 'H',
  '机': 'J', '基': 'J', '及': 'J', '即': 'J', '集': 'J', '几': 'J', '计': 'J', '记': 'J', '纪': 'J', '技': 'J', '际': 'J', '继': 'J', '加': 'J', '家': 'J', '价': 'J', '假': 'J', '间': 'J', '建': 'J', '见': 'J', '件': 'J', '将': 'J', '讲': 'J', '交': 'J', '教': 'J', '较': 'J', '接': 'J', '节': 'J', '结': 'J', '解': 'J', '界': 'J', '今': 'J', '金': 'J', '进': 'J', '近': 'J', '经': 'J', '精': 'J', '景': 'J', '警': 'J', '境': 'J', '静': 'J', '九': 'J', '就': 'J', '居': 'J', '局': 'J', '举': 'J', '具': 'J', '据': 'J', '距': 'J', '决': 'J', '绝': 'J', '军': 'J',
  '开': 'K', '看': 'K', '康': 'K', '考': 'K', '可': 'K', '克': 'K', '客': 'K', '课': 'K', '空': 'K', '口': 'K', '苦': 'K', '快': 'K', '宽': 'K', '况': 'K', '困': 'K',
  '拉': 'L', '来': 'L', '蓝': 'L', '老': 'L', '乐': 'L', '类': 'L', '累': 'L', '冷': 'L', '离': 'L', '里': 'L', '理': 'L', '力': 'L', '历': 'L', '立': 'L', '利': 'L', '连': 'L', '联': 'L', '脸': 'L', '两': 'L', '量': 'L', '了': 'L', '料': 'L', '列': 'L', '林': 'L', '临': 'L', '灵': 'L', '领': 'L', '流': 'L', '六': 'L', '龙': 'L', '楼': 'L', '路': 'L', '露': 'L', '乱': 'L', '论': 'L', '落': 'L',
  '马': 'M', '吗': 'M', '买': 'M', '卖': 'M', '满': 'M', '慢': 'M', '忙': 'M', '毛': 'M', '没': 'M', '每': 'M', '美': 'M', '门': 'M', '们': 'M', '梦': 'M', '米': 'M', '面': 'M', '民': 'M', '名': 'M', '明': 'M', '命': 'M', '模': 'M', '母': 'M', '目': 'M',
  '那': 'N', '拿': 'N', '哪': 'N', '内': 'N', '能': 'N', '你': 'N', '年': 'N', '念': 'N', '您': 'N', '牛': 'N', '农': 'N', '女': 'N',
  '哦': 'O', '欧': 'O',
  '怕': 'P', '排': 'P', '派': 'P', '判': 'P', '跑': 'P', '配': 'P', '朋': 'P', '批': 'P', '皮': 'P', '片': 'P', '票': 'P', '品': 'P', '平': 'P', '评': 'P', '破': 'P', '普': 'P',
  '七': 'Q', '其': 'Q', '起': 'Q', '气': 'Q', '器': 'Q', '千': 'Q', '前': 'Q', '钱': 'Q', '强': 'Q', '且': 'Q', '切': 'Q', '亲': 'Q', '清': 'Q', '情': 'Q', '请': 'Q', '求': 'Q', '球': 'Q', '区': 'Q', '取': 'Q', '去': 'Q', '全': 'Q', '确': 'Q',
  '然': 'R', '让': 'R', '人': 'R', '认': 'R', '任': 'R', '日': 'R', '容': 'R', '如': 'R', '入': 'R', '软': 'R',
  '三': 'S', '色': 'S', '山': 'S', '善': 'S', '上': 'S', '少': 'S', '设': 'S', '社': 'S', '身': 'S', '深': 'S', '神': 'S', '生': 'S', '声': 'S', '省': 'S', '失': 'S', '师': 'S', '十': 'S', '时': 'S', '实': 'S', '识': 'S', '史': 'S', '使': 'S', '始': 'S', '世': 'S', '市': 'S', '事': 'S', '试': 'S', '视': 'S', '是': 'S', '适': 'S', '收': 'S', '手': 'S', '首': 'S', '受': 'S', '书': 'S', '数': 'S', '双': 'S', '水': 'S', '说': 'S', '思': 'S', '死': 'S', '四': 'S', '送': 'S', '素': 'S', '速': 'S', '算': 'S', '虽': 'S', '随': 'S', '岁': 'S', '所': 'S',
  '他': 'T', '它': 'T', '她': 'T', '台': 'T', '太': 'T', '态': 'T', '谈': 'T', '汤': 'T', '堂': 'T', '逃': 'T', '讨': 'T', '特': 'T', '提': 'T', '题': 'T', '体': 'T', '天': 'T', '条': 'T', '跳': 'T', '听': 'T', '停': 'T', '通': 'T', '同': 'T', '统': 'T', '痛': 'T', '头': 'T', '投': 'T', '透': 'T', '突': 'T', '图': 'T', '土': 'T', '团': 'T', '推': 'T', '退': 'T', '脱': 'T',
  '外': 'W', '完': 'W', '玩': 'W', '晚': 'W', '万': 'W', '王': 'W', '网': 'W', '往': 'W', '忘': 'W', '望': 'W', '危': 'W', '微': 'W', '为': 'W', '围': 'W', '维': 'W', '未': 'W', '位': 'W', '味': 'W', '文': 'W', '问': 'W', '我': 'W', '握': 'W', '无': 'W', '五': 'W', '物': 'W',
  '西': 'X', '息': 'X', '希': 'X', '习': 'X', '洗': 'X', '系': 'X', '细': 'X', '下': 'X', '先': 'X', '显': 'X', '现': 'X', '线': 'X', '限': 'X', '相': 'X', '想': 'X', '向': 'X', '像': 'X', '消': 'X', '小': 'X', '校': 'X', '笑': 'X', '些': 'X', '写': 'X', '谢': 'X', '心': 'X', '新': 'X', '信': 'X', '星': 'X', '行': 'X', '形': 'X', '性': 'X', '姓': 'X', '兄': 'X', '雄': 'X', '休': 'X', '修': 'X', '需': 'X', '许': 'X', '续': 'X', '选': 'X', '学': 'X', '血': 'X',
  '压': 'Y', '呀': 'Y', '言': 'Y', '研': 'Y', '眼': 'Y', '演': 'Y', '验': 'Y', '样': 'Y', '要': 'Y', '也': 'Y', '夜': 'Y', '一': 'Y', '医': 'Y', '依': 'Y', '已': 'Y', '以': 'Y', '意': 'Y', '易': 'Y', '因': 'Y', '音': 'Y', '引': 'Y', '印': 'Y', '应': 'Y', '英': 'Y', '迎': 'Y', '影': 'Y', '用': 'Y', '优': 'Y', '由': 'Y', '有': 'Y', '又': 'Y', '右': 'Y', '于': 'Y', '余': 'Y', '鱼': 'Y', '语': 'Y', '与': 'Y', '雨': 'Y', '预': 'Y', '元': 'Y', '原': 'Y', '远': 'Y', '院': 'Y', '愿': 'Y', '约': 'Y', '月': 'Y', '越': 'Y', '云': 'Y', '运': 'Y',
  '再': 'Z', '在': 'Z', '咱': 'Z', '早': 'Z', '造': 'Z', '则': 'Z', '责': 'Z', '怎': 'Z', '增': 'Z', '展': 'Z', '占': 'Z', '战': 'Z', '站': 'Z', '张': 'Z', '章': 'Z', '掌': 'Z', '找': 'Z', '照': 'Z', '这': 'Z', '真': 'Z', '正': 'Z', '证': 'Z', '政': 'Z', '之': 'Z', '支': 'Z', '知': 'Z', '直': 'Z', '值': 'Z', '职': 'Z', '只': 'Z', '指': 'Z', '至': 'Z', '制': 'Z', '治': 'Z', '中': 'Z', '终': 'Z', '钟': 'Z', '种': 'Z', '重': 'Z', '周': 'Z', '主': 'Z', '住': 'Z', '助': 'Z', '注': 'Z', '祝': 'Z', '专': 'Z', '转': 'Z', '装': 'Z', '状': 'Z', '追': 'Z', '准': 'Z', '着': 'Z', '子': 'Z', '自': 'Z', '字': 'Z', '总': 'Z', '走': 'Z', '足': 'Z', '组': 'Z', '最': 'Z', '作': 'Z', '做': 'Z'
};

/**
 * 获取字符的拼音首字母
 * @param char 单个字符
 * @returns 拼音首字母，如果不是中文则返回原字符的大写
 */
function getPinyinInitial(char: string): string {
  if (!char) return '#';
  
  // 如果是中文字符
  if (/[\u4e00-\u9fa5]/.test(char)) {
    return pinyinMap[char] || '#';
  }
  
  // 如果是英文字母
  if (/[a-zA-Z]/.test(char)) {
    return char.toUpperCase();
  }
  
  // 如果是数字或其他字符
  if (/[0-9]/.test(char)) {
    return '#';
  }
  
  return '#';
}

/**
 * 获取字符串的拼音首字母（取第一个字符）
 * @param str 字符串
 * @returns 拼音首字母
 */
export function getPinyinInitials(str: string): string {
  if (!str || str.trim() === '') return '#';
  
  const firstChar = str.trim()[0];
  return getPinyinInitial(firstChar);
}

/**
 * 按拼音首字母排序
 * @param items 要排序的项数组
 * @param getName 获取名称的函数
 * @returns 排序后的数组
 */
export function sortByPinyin<T>(items: T[], getName: (item: T) => string): T[] {
  return [...items].sort((a, b) => {
    const nameA = getName(a);
    const nameB = getName(b);
    const initialA = getPinyinInitials(nameA);
    const initialB = getPinyinInitials(nameB);
    
    // 如果首字母相同，按原字符串排序
    if (initialA === initialB) {
      return nameA.localeCompare(nameB, 'zh-CN');
    }
    
    // 特殊字符排在最后
    if (initialA === '#') return 1;
    if (initialB === '#') return -1;
    
    return initialA.localeCompare(initialB);
  });
}

/**
 * 按拼音首字母分组
 * @param items 要分组的项数组
 * @param getName 获取名称的函数
 * @returns 分组后的对象，key为字母，value为该项数组
 */
export function groupByPinyin<T>(items: T[], getName: (item: T) => string): Record<string, T[]> {
  const grouped: Record<string, T[]> = {};
  
  items.forEach(item => {
    const name = getName(item);
    const initial = getPinyinInitials(name);
    if (!grouped[initial]) {
      grouped[initial] = [];
    }
    grouped[initial].push(item);
  });
  
  // 对每个分组内的项进行排序
  Object.keys(grouped).forEach(key => {
    grouped[key] = sortByPinyin(grouped[key], getName);
  });
  
  return grouped;
}
